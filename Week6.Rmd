---
title: 'Week 6: Visualisation of Spatial Data -- Maps'
---

<div style="margin-bottom:50px;">
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

</div>



# Introduction
* In this Lab, we will learn to draw some maps. 





# USA map
R package *maps* and *mapdata* provide some maps. We will use them for the USA map
```{r, echo=TRUE, fig.width=6, fig.align="center"}
library(ggplot2)
library(sf)
library(maps)
library(mapdata)
library(sp)
usa <- map_data("usa")
dim(usa)
head(usa)
tail(usa)
```

First, we plot usa map
```{r, echo=TRUE, fig.width=10, fig.align="center"}
library(gridExtra)
gg0 = ggplot() + geom_polygon(data = usa, aes(x=long, y = lat, group = group)) + 
  coord_fixed(1.3)
gg1 <- ggplot() + 
  geom_polygon(data = usa, aes(x=long, y = lat, group = group), fill = "violet", color = "blue") + 
  coord_fixed(1.3)
labs <- data.frame(
  long = c(-122.064873, -122.306417),
  lat = c(36.951968, 47.644855),
  names = c("SWFSC-FED", "NWFSC"),
  stringsAsFactors = FALSE
)  
gg2 = gg1 + 
  geom_point(data = labs, aes(x = long, y = lat), color = "yellow", size = 2)

grid.arrange(gg0, gg1, gg2, nrow = 1)
```

* Key points
  + "group = group" is essential, you can try code without the group argument
  + coord_fixed(): It fixes the relationship between one unit in the y direction and one unit in the x direction. 



## US state
```{r, echo=TRUE, fig.width=10, fig.align="center", warning = F}
### Draw plots for all USA States
states <- map_data("state")
ggplot(data = states) + 
  geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") + 
  coord_fixed(1.3) + guides(fill=FALSE) 

### Draw a subset of USA states
### Use function subset to select states. 
west_coast <- subset(states, region %in% c("california", "oregon", "washington"))
ggplot(data = west_coast) + 
  geom_polygon(aes(x = long, y = lat, group = group), fill = "palegreen", color = "black") + 
  coord_fixed(1.3)
```

Can you tell the difference between *color* and *fill* argument? 





# Victoria maps

* Most shapefile can found in https://data.gov.au. 
+ All LGA: VICLGA folder -- 92 elements
+ All suburb: VICSub folder  -- 2973 elements
+ LGA in Greater Melbourne -- 32 element (1st element is greater melbourne)

All datasets are read into as SpatialPolygonsDataFrame
```{r, echo=TRUE, fig.width=6, fig.align="center", message = FALSE}
library(rgdal)
library(sp)
VICLGA = readOGR(dsn = "datasets/VICLGA/VIC_LOCALITY_POLYGON_shp.shp", "VIC_LOCALITY_POLYGON_shp")
VICSub = readOGR(dsn="datasets/VICSub/VIC_LOCALITY_POLYGON_shp.shp", "VIC_LOCALITY_POLYGON_shp")
MELLGA = readOGR(dsn = "datasets/Mel/Aus-Melbourne02.shp", "Aus-Melbourne02")
```




* You will cut SpatialPolygons you wants -- Essentially manipulation of SpatialPolygons.
* One useful funciton in *crop* in package *raster*
  + crop(x, y)
+ crop returns a geographic subset of an object *x* as specified by an Extent object *y*
  + ?crop for more details

* Here we will create
+ Task 1: all surburbs in Greater Melbourne
+ Task 2: all surburbs in City of Melbourne

```{r, echo=TRUE, fig.width=6, fig.align="center", message = FALSE}
library(raster)
library(mapview)
# Before crop, first check CRS
VICLGA@proj4string
VICSub@proj4string
MELLGA@proj4string

# Making all CRS the same
crs0 = VICLGA@proj4string
MELLGA = spTransform(MELLGA, crs0)
MELLGA@proj4string

## Task 1
GMEL = MELLGA[1, ]   # Greater Melbourne
GMELSub = crop(VICSub, GMEL)
mapView(GMELSub)      

## Task 2: this code takes a while to run. 
i = which(MELLGA$name == "City of Melbourne")
CMEL = MELLGA[i, ]
#CMELSub = crop(VICSub, CMEL)      
#mapView(CMELSub) 
```



* There are more shapefiles in *PlanMelbourne* Folder, which can be downloaded from https://www.planmelbourne.vic.gov.au/maps/spatial-data
+ I have not explore all of shapefiles
+ It is quite useful. 
+ The following gives *regions of Victoria* and *CBD*
  
  ```{r, echo=TRUE, fig.width=6, fig.align="center"}
#SReg = readOGR(dsn="datasets/PlanMelbourne/Administrative/State Regions_region.shp", "State Regions_region")

#library(mapview)
#mapView(SReg)
#CBD = readOGR(dsn="2_ggplot/PlanMelbourne/Central City Urban Renewal and Precincts/Central Business District_region.shp", "Central Business District_region")
#mapView(CBD)
```

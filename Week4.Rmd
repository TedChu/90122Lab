---
title: 'Week 4: Visualisation of Spatial Data -- Melbourne Example'
---

<div style="margin-bottom:50px;">
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
</div>


# Introduction


* In this lab, you will learn 
  + Reading a map (and data) through shapefile. The example map is about all local government areas (LGA) within  Metropolitan Melbourne Area. 
  + The shapefile will be stored as SpatialPolygonsDataFrame in R. Some manipulation of SpatialPolygonsDataFrame will be presented. 
  + The visualisation of SpatialPolygonsDataFrame.



# Shapefile

* A shapefile is a simple, nontopological format for storing the geometric location and attribute information of geographic features. It usually includes the following file
  + .shp:  	geometries
  + .shx:  	an index file to the geometries
  + .dbf:	  storing attribute data


* It is developed by Esri (Environmental Systems Research Institute, the company makes famous ArcGIS software). In R, if you want to read a shapefile, the function *readOGR* from the package *rgdal* is used. 



## Melbourne Example

The shapefile is downloaded from https://www.igismap.com/australia-shapefile-download/ (This website also has shapefile of other Australia regions and cities). You can download all LGA in Victoria through  https://data.gov.au/dataset/ds-dga-bdf92691-c6fe-42b9-a0e2-a4cd716fa811/details (However, it does not indicate which LGA belongs to Greater Melbourne). 

The shapefile here is named *Aus-Melbourne02*, which records information from all LGA in Greater Melbourne. In readOGR, for more details, see help file using *?readOGR* 


*The package "rgdal" can be installed in my Windows and Mac OS system. For Mac, you also need to install Xcode and XQuartz. If you are using Ubuntu 16.04, Rstudio may have trouble to install this package. (I am sorry that I cannot fix this problem since I am not very familiar with Linux system. There is some informaiton on Internet, which may help. If it does not work, you need to find a Windows/Mac system, such as in G69.) *

* Here is some extra information: 
  + All datasets can be downloaded at https://github.com/TedChu/90122Lab/tree/master/datasets. 
  + First, set the working directory through *setwd*. Remember you need to use forward slash (/) or double slash (\\\\), but Not back slash (\\).
  + I will not recommend you to have space between your folder titles. That is, to write *setwd("..../90122Lab")*, Not *setwd("..../90122 Lab")*
  + As indicated below, all my files (*Aus-Melbourne02.shp*, *Aus-Melbourne02.dbf*, *Aus-Melbourne02.prj* and *Aus-Melbourne02.shx*) are stored at C:\\Users\\tingjinc\\OneDrive - The University of Melbourne\\Documents\\GitFile\\90122Lab\\datasets\\Mel
  + Depending on where you store your files, you need to adjust directories in *setwd* and *dsn*. 

```{r, echo=TRUE, fig.width=6, fig.align="center", message = FALSE}
library(rgdal)
library(sp)
setwd("~/Dropbox/2_MAST90122/90122LabGit")
gmel = readOGR(dsn = "datasets/Mel/Aus-Melbourne02.shp", "Aus-Melbourne02")
```

```{r, echo=TRUE, fig.width=6, fig.align="center"}
class(gmel) 
gmel = gmel[-1,]  # the first element is greater melbourne, not LGA
```

The shapefile you just read into is stored in *gmel*, which is a SpatialPolygonsDataFrame class. The olinda data includes all cities (LGA) within Metropolitan Melbourne Area.  Attributes of each neighbourhood is stored in *gmel@data*, and the geometric shape of each neighbourhood is stored as SpatialPolygons, which can be accessed using *as(gmel, "SpatialPolygons"*

## Manuplation of SpatialXXXDF

R package *mapview* provides functions to create interactive visualisation of spatial data.(For more detailed tutorial, please look at "https://r-spatial.github.io/mapview/index.html").  
A simple interactive map can generated as
```{r, echo=TRUE, fig.width=10, fig.align="center"}
library(mapview)
mapView(gmel)
```

* About no background map issue. 
  + First, you need to download Aus-Melbourne02.prj
  + If the issue does not solve. There is some information from https://github.com/r-spatial/mapview/issues/153.
  + From the above webpage, it really depends on the versions of R, Rstudio.
  + Try the following on R Viewer, click *Export*, then click *Save as Web Page*.  
  


I find out that by drawing SpatialPolygons directly on maps, it is easier to obtain a feeling of the dataset. Please click around the map, a lot of information will show up.  

Variables
```{r, echo=TRUE, fig.width=6, fig.align="center"}
gmel$name                  # Extracting a variable
gmel$ID = 1:31              # Add a new variable
gmel$ID = NULL              # Delete a variable
```

Select LGA == City of Banyule is 
```{r, echo=TRUE, fig.width=6, fig.align="center"}
i = which(gmel$name == "City of Banyule")
g = gmel[i, ]
mapView(g)
```


